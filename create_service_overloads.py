import importlib
import re

from google.ads.googleads import client

lines = []
with open("service_overloads.txt", "w") as f:
    for i, version in enumerate(sorted(client._VALID_API_VERSIONS)):
        versions_package = importlib.import_module(f"google.ads.googleads.{version}")

        for type in versions_package.__all__:
            if type.endswith("Client"):
                name = type[: -len("Client")]
                lines.append(
                    f'    @overload\n    def get_service(self, name: Literal["{name}"], version: _{version.upper()}) -> {version}.{type}: ...'
                )
                if version == client._DEFAULT_VERSION:
                    lines.append(
                        f'    @overload\n    def get_service(self, name: Literal["{name}"]) -> {version}.{type}: ...'
                    )

        if i < len(client._VALID_API_VERSIONS) - 1:
            lines.append("\n")

    lines.append(
        f'    @overload\n    def get_service(self, name: str, version: _V = "{client._DEFAULT_VERSION}") -> Any: ...'
    )

with open("google-stubs/ads/googleads/client.pyi") as f:
    client_pyi = f.read()
lines.insert(0, "# Autogenerated service overloads")
lines.append("    # End of autogenerated service overloads")
client_pyi = re.sub(
    "# Autogenerated service overloads.+# End of autogenerated service overloads",
    "\n".join(lines),
    client_pyi,
    flags=re.DOTALL,
)
with open("google-stubs/ads/googleads/client.pyi", mode="w") as f:
    f.write(client_pyi)
